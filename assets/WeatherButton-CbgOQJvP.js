import{r,j as e,P as L}from"./index-8b-tWTXh.js";import"./_commonjsHelpers-Cpj98o6Y.js";const M="fixed inset-0 z-[1000] bg-black/50 backdrop-blur-sm flex items-center justify-center",B="w-[92vw] max-w-[720px] max-h-[88vh] overflow-hidden glass rounded-2xl border border-white/15 shadow-2xl bg-white/10 backdrop-blur-xl text-zinc-100",z="flex items-center justify-between px-4 sm:px-5 py-3 border-b border-white/10",J="text-zinc-300 hover:text-white text-2xl leading-none font-bold px-2",R="p-4 sm:p-5";function _({label:S="Weather",className:C="",apiKey:p="56c6e90bfff82043ae93482cab965c0f",portalSelector:E="body"}){const[h,u]=r.useState(!1),[g,f]=r.useState(!1),[y,c]=r.useState(null),[$,D]=r.useState(""),[x,P]=r.useState(null),[w,b]=r.useState([]);r.useEffect(()=>{if(!h)return;document.body.style.overflow="hidden";const t=n=>n.key==="Escape"&&u(!1);return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t),document.body.style.overflow=""}},[h]);async function v(t,n){f(!0),c(null);try{const s=`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${n}&appid=${p}&units=metric&lang=vi`,a=await fetch(s);if(a.ok){const i=await a.json();P(i),D(i.name||"V·ªã tr√≠ hi·ªán t·∫°i")}const l=`https://api.openweathermap.org/data/3.0/onecall?lat=${t}&lon=${n}&appid=${p}&units=metric&lang=vi&exclude=minutely,alerts`;try{const i=await fetch(l);if(i.ok){const m=(await i.json())?.daily||[];b(m.slice(0,3))}else await j(t,n)}catch{await j(t,n)}}catch(s){c(s?.message||"Kh√¥ng th·ªÉ t·∫£i th·ªùi ti·∫øt")}finally{f(!1)}}async function j(t,n){try{const s=`https://api.openweathermap.org/data/2.5/forecast?lat=${t}&lon=${n}&appid=${p}&units=metric&lang=vi`,a=await fetch(s);if(!a.ok)throw new Error(`L·ªói API: ${a.status}`);const i=(await a.json())?.list||[],d=[],m=new Set;for(const o of i){const k=new Date(o.dt*1e3).toDateString();if(!m.has(k)&&(d.push({dt:o.dt,temp:{min:o.main.temp_min,max:o.main.temp_max},weather:o.weather,clouds:o.clouds?.all??0,pop:o.pop??0}),m.add(k),d.length>=3))break}b(d)}catch(s){c(s?.message||"Kh√¥ng th·ªÉ t·∫£i d·ª± b√°o")}}async function N(){if(c(null),!("geolocation"in navigator)){c("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã");return}const t=localStorage.getItem("savedLocation"),n=localStorage.getItem("locationPermission");if(t&&n==="granted")try{const s=JSON.parse(t);if(Date.now()-(s.timestamp||0)<1800*1e3){await v(s.latitude,s.longitude);return}}catch{}try{if(navigator.permissions?.query&&(await navigator.permissions.query({name:"geolocation"})).state==="denied"){localStorage.setItem("locationPermission","denied"),c("Quy·ªÅn truy c·∫≠p v·ªã tr√≠ ƒë√£ b·ªã t·ª´ ch·ªëi");return}}catch{}await new Promise(s=>{navigator.geolocation.getCurrentPosition(async a=>{const{latitude:l,longitude:i}=a.coords;localStorage.setItem("locationPermission","granted"),localStorage.setItem("savedLocation",JSON.stringify({latitude:l,longitude:i,timestamp:Date.now()})),await v(l,i),s()},a=>{a.code===a.PERMISSION_DENIED?(localStorage.setItem("locationPermission","denied"),c("ƒê·∫°i ca ch∆∞a c·∫•p quy·ªÅn v·ªã tr√≠")):c(`Kh√¥ng l·∫•y ƒë∆∞·ª£c v·ªã tr√≠: ${a.message}`),s()},{timeout:1e4,enableHighAccuracy:!1,maximumAge:3e5})})}r.useEffect(()=>{h&&N()},[h]);function I({d:t,idx:n}){const s=new Date(t.dt*1e3),a=n===0?"H√¥m nay":s.toLocaleDateString("vi-VN",{weekday:"short"}),l=Math.round(t.temp.min),i=Math.round(t.temp.max),d=t.weather?.[0]?.description||"",m=t.clouds??0,o=Math.round((t.pop??0)*100);return e.jsxs("div",{className:"py-2 border-b border-white/10 last:border-0",children:[e.jsx("div",{className:"text-sm font-medium",children:a}),e.jsxs("div",{className:"text-xs opacity-80",children:[l,"¬∞/",i,"¬∞C, ",d]}),e.jsxs("div",{className:"text-[11px] opacity-60",children:["‚òÅÔ∏è",m,"% ¬∑ üåßÔ∏è",o,"%"]})]})}return e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:C||"rounded-xl border border-white/15 bg-white/10 backdrop-blur-md px-3 py-2 text-sm font-semibold text-white hover:bg-white/20",onClick:()=>u(!0),children:S}),h&&e.jsx(L,{selector:E,children:e.jsx("div",{className:M,onMouseDown:t=>t.target===t.currentTarget&&u(!1),children:e.jsxs("div",{className:`${B} animate-in fade-in zoom-in duration-150`,children:[e.jsxs("div",{className:z,children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Th·ªùi ti·∫øt"}),e.jsx("button",{className:J,onClick:()=>u(!1),"aria-label":"ƒê√≥ng",children:"√ó"})]}),e.jsxs("div",{className:`${R} grid grid-cols-1 md:grid-cols-2 gap-4`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80",children:"ƒê·ªãa ƒëi·ªÉm"}),e.jsx("div",{className:"text-xl font-semibold",children:$||"ƒêang x√°c ƒë·ªãnh..."}),e.jsx("div",{className:"mt-3 p-3 rounded-xl bg-white/5 border border-white/10",children:g?e.jsxs("div",{className:"flex items-center gap-2 text-sm opacity-80",children:[e.jsxs("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"ƒêang t·∫£i d·ªØ li·ªáu..."]}):y?e.jsx("div",{className:"text-red-200 text-sm",children:y}):x?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(x.main?.temp??0),"¬∞C"]}),e.jsx("div",{className:"text-sm opacity-80",children:x.weather?.[0]?.description}),e.jsxs("div",{className:"text-xs opacity-60",children:["C·∫£m nh·∫≠n: ",Math.round(x.main?.feels_like??0),"¬∞C"]})]}):e.jsx("div",{className:"text-sm opacity-80",children:"Kh√¥ng c√≥ d·ªØ li·ªáu."})}),e.jsx("button",{className:"mt-2 rounded-lg bg-blue-600 text-white text-sm font-medium px-3 py-2 hover:bg-blue-700",onClick:()=>N(),children:"L√†m m·ªõi v·ªã tr√≠"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm opacity-80",children:"D·ª± b√°o 3 ng√†y"}),e.jsx("div",{className:"rounded-xl bg-white/5 border border-white/10 p-3",children:w.length?w.map((t,n)=>e.jsx(I,{d:t,idx:n},t.dt)):e.jsx("div",{className:"text-sm opacity-80",children:g?"ƒêang t·∫£i...":"Ch∆∞a c√≥ d·ª± b√°o"})})]})]})]})})})]})}export{_ as default};
