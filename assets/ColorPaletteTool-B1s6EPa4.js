import{r as a,j as n}from"./index-DvwrxnGx.js";import"./_commonjsHelpers-Cpj98o6Y.js";const F="w-full rounded-xl border border-zinc-300/70 bg-white/60 backdrop-blur px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-cyan-500/60 dark:bg-zinc-900/50 dark:border-zinc-700",me=.25,xe=6,ge=.12;function we(){const f=a.useRef(null),g=a.useRef(null),T=a.useRef(null),b=a.useRef(null),[i,U]=a.useState({w:0,h:0,dpr:1}),[l,P]=a.useState(null),[y,Z]=a.useState(1),[j,N]=a.useState(1),[h,C]=a.useState({x:0,y:0}),[V,z]=a.useState(!1),[L,_]=a.useState({x:0,y:0}),[x,B]=a.useState(""),[u,p]=a.useState([]),[W,H]=a.useState("monochrome"),[S,D]=a.useState(!1),[q,Q]=a.useState(!1),[I,G]=a.useState({x:0,y:0}),w=a.useCallback(()=>{const t=f.current,e=g.current;if(!t||!e)return;const s=t.getBoundingClientRect(),o=window.devicePixelRatio||1;e.width=Math.max(1,Math.round(s.width*o)),e.height=Math.max(1,Math.round(s.height*o)),e.style.width=s.width+"px",e.style.height=s.height+"px";const r=e.getContext("2d");r&&r.setTransform(o,0,0,o,0,0),U({w:s.width,h:s.height,dpr:o})},[]);a.useEffect(()=>{w();const t=()=>w();window.addEventListener("resize",t);const e=window.ResizeObserver,s=e?new e(()=>w()):null;return s&&f.current&&s.observe(f.current),()=>{window.removeEventListener("resize",t),s?.disconnect()}},[w]);const M=t=>{const e=new FileReader;e.onload=s=>{const o=new Image;o.onload=()=>P(o),o.src=String(s.target?.result||"")},e.readAsDataURL(t)},J=t=>{const e=t.target.files?.[0];e&&M(e),b.current&&(b.current.value="")};a.useEffect(()=>{const t=o=>{const r=o.clipboardData?.items;if(r)for(let c=0;c<r.length;c++){const d=r[c];if(d.type.startsWith("image/")){const m=d.getAsFile();m&&M(m);break}}},e=o=>{o.preventDefault(),o.stopPropagation()},s=o=>{const r=o.dataTransfer?.files?.[0];r&&M(r)};return window.addEventListener("paste",t),["dragenter","dragover","dragleave","drop"].forEach(o=>document.body.addEventListener(o,e)),document.body.addEventListener("drop",s),()=>{window.removeEventListener("paste",t),["dragenter","dragover","dragleave","drop"].forEach(o=>document.body.removeEventListener(o,e)),document.body.removeEventListener("drop",s)}},[]),a.useEffect(()=>{if(!l||!i.w||!i.h)return;const t=i.w/l.naturalWidth,e=i.h/l.naturalHeight,s=Math.min(t,e);Z(s),N(1),C({x:0,y:0})},[l,i.w,i.h]);const O=a.useCallback(()=>{const t=g.current;if(!t)return;const e=t.getContext("2d");if(!e||(e.clearRect(0,0,i.w,i.h),!l))return;const s=y*j,o=l.naturalWidth*s,r=l.naturalHeight*s,c=(i.w-o)/2+h.x,d=(i.h-r)/2+h.y;e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(l,0,0,l.naturalWidth,l.naturalHeight,c,d,o,r)},[l,y,j,h.x,h.y,i.w,i.h]);a.useEffect(()=>{O()},[O]);const K=t=>{z(!0);const e=t.target.getBoundingClientRect();_({x:t.clientX-e.left-h.x,y:t.clientY-e.top-h.y})},ee=t=>{const e=t.target.getBoundingClientRect();G({x:t.clientX-e.left-25,y:t.clientY-e.top-25}),Q(!0),V&&C({x:t.clientX-e.left-L.x,y:t.clientY-e.top-L.y})},X=()=>z(!1),te=t=>{t.preventDefault();const e=t.deltaY>0?-1:1;N(s=>Math.max(me,Math.min(xe,Number((s+e*ge).toFixed(3)))))},ne=(t,e,s)=>"#"+((1<<24)+(t<<16)+(e<<8)+s).toString(16).slice(1),se=(t,e)=>{if(!l||!g.current)return;const s=g.current.getBoundingClientRect(),o=t-s.left,r=e-s.top,c=y*j,d=l.naturalWidth*c,m=l.naturalHeight*c,k=(i.w-d)/2+h.x,v=(i.h-m)/2+h.y,ie=(o-k)/c,de=(r-v)/c,he=Math.max(0,Math.min(l.naturalWidth-1,Math.floor(ie))),ue=Math.max(0,Math.min(l.naturalHeight-1,Math.floor(de))),R=document.createElement("canvas");R.width=l.naturalWidth,R.height=l.naturalHeight;const $=R.getContext("2d");$.drawImage(l,0,0);const E=$.getImageData(he,ue,1,1).data,A=ne(E[0],E[1],E[2]);B(A),Y(A)},oe=t=>{se(t.clientX,t.clientY)},Y=async(t,e)=>{D(!0),p([]);const s=t.replace(/^#/,""),o=e||W;try{const r=await fetch(`https://www.thecolorapi.com/scheme?hex=${s}&mode=${o}&count=6`);if(!r.ok)throw new Error("HTTP "+r.status);const c=await r.json();p(c.colors||[])}catch(r){console.error(r),p([])}finally{D(!1)}},ae=t=>{const e=t.target.value;H(e),x&&Y(x,e)},re=(t,e)=>{navigator.clipboard.writeText(t).then(()=>{const s=e.querySelector("p"),o=s?.innerText;s&&(s.innerText="Đã sao chép!",setTimeout(()=>s.innerText=o||t,1200))})},le=()=>{if(!u.length)return;const t=T.current;if(!t)return;const e=t.getContext("2d");if(!e)return;const s=120,o=100,r=30,c=20;t.width=s*u.length+c*2,t.height=o+r+c*2,e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height),e.textAlign="center",e.font="16px sans-serif",u.forEach((m,k)=>{const v=c+k*s;e.fillStyle=m.hex.value,e.fillRect(v,c,s,o),e.fillStyle="#000",e.fillText(m.hex.value,v+s/2,c+o+20)});const d=document.createElement("a");d.download=`color-palette-${x.replace("#","")}.png`,d.href=t.toDataURL("image/png"),d.click()},ce=()=>{P(null),B(""),p([]),H("monochrome"),N(1),C({x:0,y:0})};return n.jsxs("div",{className:"w-full h-full overflow-hidden",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100%-1.5rem)]",children:[n.jsxs("div",{className:"min-w-0 overflow-auto lg:overflow-hidden",children:[n.jsxs("div",{className:"mb-3 flex flex-wrap items-center gap-2 ml-2 mr-2 mt-2",children:[n.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[n.jsx("span",{className:"hidden sm:inline",children:"Tải ảnh"}),n.jsx("span",{className:"rounded-md bg-cyan-500 px-3 py-1.5 text-xs text-white hover:bg-cyan-600",children:"Chọn tệp"}),n.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:J,className:"hidden"})]}),n.jsx("span",{className:"text-xs opacity-70 ml-2 mt-3",children:"hoặc dán ảnh từ clipboard (Ctrl+V)"})]}),n.jsxs("div",{ref:f,className:"ml-2 mr-2 relative w-full h-[360px] border border-zinc-300 rounded-xl overflow-hidden bg-zinc-100",children:[n.jsx("canvas",{ref:g,className:"absolute inset-0 w-full h-full cursor-crosshair",onMouseDown:K,onMouseMove:ee,onMouseUp:X,onMouseLeave:X,onWheel:te,onClick:oe}),n.jsx("div",{className:"absolute pointer-events-none rounded-full border-4 border-white shadow-lg z-10",style:{display:q?"block":"none",left:`${I.x}px`,top:`${I.y}px`,width:"50px",height:"50px"}})]})]}),n.jsx("div",{className:"min-w-0 overflow-hidden",children:n.jsxs("div",{className:"flex h-full flex-col items-center justify-start p-0",children:[n.jsxs("div",{className:"w-full items-start justify-center grid-rows-3",children:[n.jsx("div",{className:"w-full",children:x&&n.jsxs("div",{className:"flex flex-col gap-2 ml-2 mr-2 mt-2",children:[n.jsx("label",{className:"text-sm font-medium",children:"Màu đã chọn"}),n.jsxs("div",{className:`${F} flex items-center gap-4 p-3`,children:[n.jsx("div",{className:"w-12 h-12 rounded-md border-2 border-white shadow-md",style:{backgroundColor:x}}),n.jsx("p",{className:"font-mono text-slate-700 dark:text-slate-200",children:x.toUpperCase()})]})]})}),n.jsxs("div",{className:"mb-3 flex-wrap items-center gap-2 ml-2 mr-2 mt-2 w-full",children:[n.jsx("label",{htmlFor:"scheme-select",className:"font-medium text-sm",children:"Loại Palette:"}),n.jsxs("select",{id:"scheme-select",className:`${F} w-[195px] ml-5`,value:W,onChange:ae,children:[n.jsx("option",{value:"monochrome",children:"Đơn sắc (Monochrome)"}),n.jsx("option",{value:"monochrome-dark",children:"Đơn sắc tối"}),n.jsx("option",{value:"monochrome-light",children:"Đơn sắc sáng"}),n.jsx("option",{value:"analogic",children:"Tương đồng (Analogic)"}),n.jsx("option",{value:"complement",children:"Bổ sung (Complement)"}),n.jsx("option",{value:"analogic-complement",children:"Tương đồng-Bổ sung"}),n.jsx("option",{value:"triad",children:"Bộ ba (Triad)"}),n.jsx("option",{value:"quad",children:"Bộ bốn (Quad)"})]})]}),n.jsxs("div",{className:"w-full px-2 space-y-4",children:[S&&n.jsx("div",{className:"flex justify-center py-12",children:n.jsx("div",{className:"border-4 border-zinc-300 border-t-zinc-600 rounded-full w-12 h-12 animate-spin"})}),!S&&u.length===0&&n.jsxs("div",{className:"text-center py-12 text-zinc-500",children:[n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),n.jsx("p",{className:"mt-2",children:"Palette sẽ hiển thị ở đây sau khi bạn chọn màu."})]}),!S&&u.length>0&&n.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3",children:u.map((t,e)=>n.jsxs("div",{className:"text-center cursor-pointer transition-all duration-200 hover:scale-105",onClick:s=>re(t.hex.value,s.currentTarget),children:[n.jsx("div",{className:"h-24 rounded-lg shadow-md mx-auto",style:{backgroundColor:t.hex.value}}),n.jsx("p",{className:"mt-2 font-mono text-sm font-medium",children:t.hex.value})]},e))})]})]}),n.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-center gap-2",children:[n.jsx("button",{onClick:ce,className:"rounded-xl bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-700",children:"Đặt lại"}),u.length>0&&n.jsx("button",{onClick:le,className:"rounded-xl bg-cyan-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-cyan-700",children:"Tải PNG"})]})]})})]}),n.jsx("canvas",{ref:T,style:{display:"none"}})]})}export{we as default};
