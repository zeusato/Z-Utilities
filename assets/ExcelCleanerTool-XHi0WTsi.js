import{r as d,j as s}from"./index-DvwrxnGx.js";import"./_commonjsHelpers-Cpj98o6Y.js";const N=({children:x})=>s.jsx("div",{className:"text-xl mr-3 text-cyan-500",children:x});function V(){const[x,v]=d.useState([]),[z,w]=d.useState(!1),[T,C]=d.useState(0),[X,k]=d.useState(""),[S,f]=d.useState(null),b=d.useRef(null),[h,E]=d.useState(!1),[B,M]=d.useState(null);d.useEffect(()=>{if(window.XLSX&&window.JSZip){E(!0);return}const e=t=>new Promise((l,n)=>{const c=document.createElement("script");c.src=t,c.async=!0,c.onload=()=>l(),c.onerror=()=>n(new Error(`Failed to load script: ${t}`)),document.body.appendChild(c)});Promise.all([e("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"),e("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js")]).then(()=>{E(!0),console.log("SheetJS and JSZip libraries loaded successfully.")}).catch(t=>{console.error(t),M("Kh√¥ng th·ªÉ t·∫£i c√°c th∆∞ vi·ªán c·∫ßn thi·∫øt. Vui l√≤ng l√†m m·ªõi trang."),m("error","L·ªói t·∫£i t√†i nguy√™n, vui l√≤ng th·ª≠ l·∫°i.")})},[]);const m=(e,t,l=5e3)=>{f({type:e,text:t}),setTimeout(()=>f(null),l)},R=e=>{if(e===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+l[n]},P=e=>{const t=window.XLSX;if(!e||!e["!ref"])return{changed:!1,cleanedCells:0};const l=t.utils.decode_range(e["!ref"]);let n=0,c=!1;for(let r=l.s.r;r<=l.e.r;r++)for(let a=l.s.c;a<=l.e.c;a++){const i=t.utils.encode_cell({r,c:a}),o=e[i];o&&(o.v===void 0||o.v===null||o.v==="")&&!o.f&&(delete e[i],n++,c=!0)}if(c){const r={s:{r:1/0,c:1/0},e:{r:0,c:0}};let a=!1;Object.keys(e).forEach(i=>{if(i[0]==="!")return;a=!0;const o=t.utils.decode_cell(i);r.s.r=Math.min(r.s.r,o.r),r.s.c=Math.min(r.s.c,o.c),r.e.r=Math.max(r.e.r,o.r),r.e.c=Math.max(r.e.c,o.c)}),a?e["!ref"]=t.utils.encode_range(r):e["!ref"]="A1"}return{changed:c,cleanedCells:n}},U=async e=>{const t=window.XLSX;return new Promise(l=>{const n=new FileReader;n.onload=c=>{try{const r=new Uint8Array(c.target?.result),a=t.read(r,{type:"array"});let i=!1,o=[];if(Object.keys(a.Sheets).forEach(p=>{const g=P(a.Sheets[p]);g.changed&&(i=!0,o.push(`${p}: D·ªçn ${g.cleanedCells} √¥ tr·ªëng`))}),a.Workbook&&a.Workbook.Names){const p=a.Workbook.Names.length;a.Workbook.Names=a.Workbook.Names.filter($=>$&&$.Ref&&!$.Ref.includes("#REF!"));const g=p-a.Workbook.Names.length;g>0&&(i=!0,o.push(`X√≥a ${g} named range l·ªói`))}let j=null,y=e.size;if(i){const p=t.write(a,{bookType:"xlsx",type:"array",compression:!0});j=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),y=j.size}const F=e.size>0?(e.size-y)/e.size*100:0;let D="File ƒë√£ t·ªëi ∆∞u";i&&F>=1?D=o.join("; "):i||(j=null,y=e.size),l({originalFile:e,fileName:e.name,originalSize:e.size,processedSize:y,reduction:Math.max(0,F),status:D,processedBlob:j,hasError:!1})}catch(r){l({originalFile:e,fileName:e.name,originalSize:e.size,processedSize:e.size,reduction:0,status:`L·ªói: ${r.message}`,processedBlob:null,hasError:!0})}},n.onerror=()=>{l({originalFile:e,fileName:e.name,originalSize:e.size,processedSize:e.size,reduction:0,status:"L·ªói kh√¥ng th·ªÉ ƒë·ªçc file",processedBlob:null,hasError:!0})},n.readAsArrayBuffer(e)})},L=d.useCallback(async e=>{if(!e||e.length===0)return;if(!h){m("error","Th∆∞ vi·ªán x·ª≠ l√Ω file ch∆∞a s·∫µn s√†ng, vui l√≤ng th·ª≠ l·∫°i sau gi√¢y l√°t.");return}const t=Array.from(e).filter(n=>n.name.endsWith(".xlsx")||n.name.endsWith(".xls"));if(t.length===0){m("error","Vui l√≤ng ch·ªâ ch·ªçn file Excel (.xlsx, .xls)");return}w(!0),v([]),f(null);const l=[];for(let n=0;n<t.length;n++){const c=t[n];C((n+1)/t.length*100),k(`ƒêang x·ª≠ l√Ω: ${c.name} (${n+1}/${t.length})`);const r=await U(c);l.push(r)}v(l),w(!1),k(`Ho√†n t·∫•t! ƒê√£ x·ª≠ l√Ω ${t.length} file.`),m("success",`ƒê√£ x·ª≠ l√Ω xong ${t.length} file.`)},[h]),A=d.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("border-cyan-500","scale-105"),L(e.dataTransfer.files)},[L]),O=e=>{e.preventDefault(),e.stopPropagation()},W=e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.add("border-cyan-500","scale-105")},_=e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("border-cyan-500","scale-105")},I=e=>{if(!e.processedBlob)return;const t=URL.createObjectURL(e.processedBlob),l=document.createElement("a");l.href=t,l.download=e.fileName.replace(/\.(xlsx|xls)$/i,"_cleaned.$1"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)},K=async()=>{const e=window.JSZip,t=new e;let l=0;if(x.forEach(n=>{if(n.processedBlob){const c=n.fileName.replace(/\.(xlsx|xls)$/i,"_cleaned.$1");t.file(c,n.processedBlob),l++}}),l>0){const n=await t.generateAsync({type:"blob"}),c=URL.createObjectURL(n),r=document.createElement("a");r.href=c,r.download="excel_cleaned_files.zip",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(c)}else m("error","Kh√¥ng c√≥ file n√†o ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω ƒë·ªÉ t·∫£i v·ªÅ.")},J=()=>{v([]),w(!1),C(0),k(""),f(null),b.current&&(b.current.value=""),m("success","ƒê√£ l√†m m·ªõi c√¥ng c·ª•.")},Z=x.some(e=>e.processedBlob!==null),u="border border-zinc-300/40 bg-white/40 backdrop-blur-xl rounded-2xl shadow-lg dark:bg-zinc-800/40 dark:border-zinc-700/40";return s.jsx("div",{className:"w-full h-full p-4 text-zinc-800 dark:text-zinc-200",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full",children:[s.jsxs("div",{className:"flex flex-col gap-6 min-h-0",children:[s.jsxs("div",{className:`${u} flex-grow flex flex-col items-center justify-center text-center p-6 border-2 border-dashed border-transparent transition-all duration-300 ${h?"cursor-pointer":"cursor-not-allowed opacity-70"}`,onClick:()=>h&&b.current?.click(),onDrop:A,onDragOver:O,onDragEnter:W,onDragLeave:_,children:[s.jsx("div",{className:"text-5xl mb-4",children:"üìÅ"}),s.jsx("p",{className:"font-semibold",children:"K√©o th·∫£ file Excel v√†o ƒë√¢y"}),s.jsx("p",{className:"text-xs opacity-70 mb-4",children:"H·ªó tr·ª£ .xlsx, .xls - C√≥ th·ªÉ ch·ªçn nhi·ªÅu file"}),s.jsx("button",{type:"button",disabled:!h||!!B,className:"px-6 py-2 bg-cyan-600 text-white rounded-lg font-semibold shadow-md hover:bg-cyan-700 transition disabled:bg-zinc-400 disabled:cursor-wait",children:B?"L·ªói t·∫£i th∆∞ vi·ªán":h?"Ho·∫∑c ch·ªçn t·ª´ m√°y t√≠nh":"‚è≥ ƒêang t·∫£i th∆∞ vi·ªán..."}),s.jsx("input",{type:"file",ref:b,className:"hidden",multiple:!0,accept:".xlsx,.xls",onChange:e=>L(e.target.files),disabled:!h})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[s.jsxs("div",{className:`${u} p-1 flex items-center`,children:[s.jsx(N,{children:"üõ°Ô∏è"})," ",s.jsx("span",{className:"text-sm",children:"An to√†n, kh√¥ng ·∫£nh h∆∞·ªüng d·ªØ li·ªáu."})]}),s.jsxs("div",{className:`${u} p-1 flex items-center`,children:[s.jsx(N,{children:"üîó"})," ",s.jsx("span",{className:"text-sm",children:"X·ª≠ l√Ω Named Ranges l·ªói."})]}),s.jsxs("div",{className:`${u} p-1 flex items-center`,children:[s.jsx(N,{children:"‚úÖ"})," ",s.jsx("span",{className:"text-sm",children:"B·∫£o to√†n 100% c√¥ng th·ª©c."})]}),s.jsxs("div",{className:`${u} p-1 flex items-center`,children:[s.jsx(N,{children:"üìä"})," ",s.jsx("span",{className:"text-sm",children:"B√°o c√°o dung l∆∞·ª£ng chi ti·∫øt."})]})]})]}),s.jsxs("div",{className:`${u} flex flex-col min-h-0 p-6`,children:[s.jsx("h2",{className:"text-xl font-bold mb-4 text-cyan-600 dark:text-cyan-400",children:"K·∫øt Qu·∫£ X·ª≠ L√Ω"}),S&&s.jsx("div",{className:`mb-4 rounded-lg px-4 py-2 text-sm ${S.type==="success"?"bg-emerald-100 text-emerald-800 border border-emerald-300":"bg-rose-100 text-rose-800 border border-rose-300"}`,children:S.text}),z&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[s.jsx("div",{className:"w-full bg-zinc-200 rounded-full h-2.5 dark:bg-zinc-700 mb-2",children:s.jsx("div",{className:"bg-cyan-600 h-2.5 rounded-full",style:{width:`${T}%`}})}),s.jsx("p",{className:"text-sm opacity-80",children:X})]}),!z&&x.length===0&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-zinc-500",children:[s.jsx("div",{className:"text-4xl mb-2",children:"‚ú®"}),s.jsx("p",{children:"K·∫øt qu·∫£ s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi b·∫°n t·∫£i file l√™n."})]}),!z&&x.length>0&&s.jsxs("div",{className:"flex flex-col flex-grow min-h-0",children:[s.jsx("div",{className:"overflow-y-auto flex-grow pr-2",children:s.jsxs("table",{className:"w-full text-sm text-left",children:[s.jsx("thead",{className:"text-xs text-zinc-700 uppercase bg-zinc-50/50 dark:bg-zinc-700/50 dark:text-zinc-400 sticky top-0",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",className:"px-4 py-3",children:"T√™n file"}),s.jsx("th",{scope:"col",className:"px-4 py-3",children:"G·ªëc"}),s.jsx("th",{scope:"col",className:"px-4 py-3",children:"Sau XL"}),s.jsx("th",{scope:"col",className:"px-4 py-3",children:"Gi·∫£m"}),s.jsx("th",{scope:"col",className:"px-4 py-3",children:"T·∫£i"})]})}),s.jsx("tbody",{children:x.map((e,t)=>s.jsxs("tr",{className:"border-b dark:border-zinc-700 hover:bg-zinc-50/50 dark:hover:bg-zinc-700/30",children:[s.jsx("td",{className:"px-4 py-2 font-medium truncate max-w-xs",title:e.fileName,children:e.fileName}),s.jsx("td",{className:"px-4 py-2",children:R(e.originalSize)}),s.jsx("td",{className:"px-4 py-2",children:R(e.processedSize)}),s.jsx("td",{className:`px-4 py-2 font-semibold ${e.reduction>5?"text-emerald-500":"text-zinc-500"}`,children:e.reduction>=1?`${e.reduction.toFixed(1)}%`:"-"}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("button",{onClick:()=>I(e),disabled:!e.processedBlob,className:"px-2 py-1 text-xs bg-cyan-600 text-white rounded hover:bg-cyan-700 disabled:bg-zinc-400 disabled:cursor-not-allowed",children:"T·∫£i"})})]},t))})]})}),s.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 mt-auto border-t border-zinc-200 dark:border-zinc-700",children:[s.jsx("button",{onClick:K,disabled:!Z,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-semibold shadow-md hover:bg-emerald-700 transition disabled:bg-zinc-400 disabled:opacity-70 disabled:cursor-not-allowed",children:"üì¶ T·∫£i t·∫•t c·∫£ (.zip)"}),s.jsx("button",{onClick:J,className:"px-6 py-2 bg-zinc-500 text-white rounded-lg font-semibold shadow-md hover:bg-zinc-600 transition",children:"üîÑ L√†m m·ªõi"})]})]})]})]})})}export{V as default};
